<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸŒ¶ï¸Ğ§Ğ¸Ğ»Ğ¸Ğ§Ğ°Ñ‚</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="P2P video chat application">
<!-- Disable caching as much as possible from the client side -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<style>
body{margin:0;font-family:sans-serif;background:#111;color:#fff;text-align:center;}
/* Generic hidden helper used by JS to hide controls */
.hidden{display:none !important}
video{width:100vw;height:100vh;object-fit:cover;background:#000;}
button{padding:10px 15px;font-size:16px;border-radius:6px;background:transparent;border:none;color:inherit}
#status{position:fixed;bottom:10px;width:100%;text-align:center;font-size:14px;}
/* controls container fixed; children flow inline */
#controls{position:fixed;top:10px;left:10px;display:flex;gap:8px;align-items:center;z-index:10000}
#switchCamBtn{background:transparent;border:1px solid rgba(255,255,255,0.5);color:#fff;cursor:pointer;padding:8px 10px;border-radius:6px}
#micToggle,#outputToggle,#hangupBtn,#refreshBtn{background:transparent;border:1px solid rgba(255,255,255,0.15);color:#fff;cursor:pointer;padding:8px;border-radius:6px}
#micSelect,#outputSelect{background:rgba(0,0,0,0.6);color:#fff;border:1px solid rgba(255,255,255,0.12);padding:6px;border-radius:6px}
#micSelect.hidden,#outputSelect.hidden,#roomSelect.hidden{display:none;position:relative}
#micSelect{min-width:180px}
#outputSelect{min-width:160px}
/* room selector */
#roomThumb{font-size:20px;display:inline-flex;align-items:center;justify-content:center;padding:6px;border-radius:6px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);cursor: pointer;}
#roomSelect{background:rgba(0,0,0,0.6);color:#fff;border:1px solid rgba(255,255,255,0.12);padding:6px;border-radius:6px;min-width:160px}
</style>
</head>
<body>

<video id="remoteVideo" autoplay playsinline></video>
<div id="controls">
	<button id="switchCamBtn">ğŸ“·</button>
	<button id="micToggle" title="Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¼Ğ¸ĞºÑ€Ğ¾Ñ„Ğ¾Ğ½">ğŸ™ï¸</button>
	<select id="micSelect" aria-label="Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¼Ğ¸ĞºÑ€Ğ¾Ñ„Ğ¾Ğ½Ğ°" class="hidden"></select>
	<button id="outputToggle" title="Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ²Ñ‹Ñ…Ğ¾Ğ´">ğŸ”Š</button>
	<select id="outputSelect" aria-label="Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°" class="hidden"></select>
	<span id="roomThumb">ğŸ·ï¸</span>
	<select id="roomSelect" aria-label="Ğ’Ñ‹Ğ±Ğ¾Ñ€ ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñ‹" class="hidden"></select>
	<button id="hangupBtn" title="Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ·Ğ²Ğ¾Ğ½Ğ¾Ğº">ğŸ“</button>
	<button id="refreshBtn" title="ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ">ğŸ”„</button>
</div>
<p id="status">Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ...</p>

<script>
// Try to stop service workers (if any) so they don't cache responses
if('serviceWorker' in navigator){
	navigator.serviceWorker.getRegistrations().then(regs=>regs.forEach(r=>r.unregister())).catch(()=>{});
}

// If the page is restored from bfcache, reload to get a fresh copy
window.addEventListener('pageshow', (e)=>{
	if(e.persisted) {
		const u = new URL(window.location.href);
		u.searchParams.set('_', Date.now());
		window.location.replace(u.toString());
	}
});

// Intercept F5 / Ctrl+R / Cmd+R and reload with cache-busting param
window.addEventListener('keydown', (e)=>{
	const isReload = e.key === 'F5' || ((e.ctrlKey||e.metaKey) && e.key.toLowerCase() === 'r');
	if(isReload){
		e.preventDefault();
		const u = new URL(window.location.href);
		u.searchParams.set('_', Date.now());
		window.location.href = u.toString();
	}
});
</script>
<script src="video-chat.js"></script>
</body>
</html>
