<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üå∂Ô∏èTelePerchik P2P</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Disable caching as much as possible from the client side -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<style>
body{margin:0;font-family:sans-serif;background:#111;color:#fff;text-align:center;}
video{width:100vw;height:100vh;object-fit:cover;background:#000;}
button{padding:10px 15px;font-size:16px;border-radius:6px;background:transparent;border:none;color:inherit}
#status{position:fixed;bottom:10px;width:100%;text-align:center;font-size:14px;}
/* controls container fixed; children flow inline */
#controls{position:fixed;top:10px;left:10px;display:flex;gap:8px;align-items:center;z-index:10000}
#switchCamBtn{background:transparent;border:1px solid rgba(255,255,255,0.5);color:#fff;cursor:pointer;padding:8px 10px;border-radius:6px}
#micToggle,#outputToggle{background:transparent;border:1px solid rgba(255,255,255,0.15);color:#fff;cursor:pointer;padding:8px;border-radius:6px}
#micSelect,#outputSelect{background:rgba(0,0,0,0.6);color:#fff;border:1px solid rgba(255,255,255,0.12);padding:6px;border-radius:6px}
#micSelect.hidden,#outputSelect.hidden{display:none;position:relative}
#micSelect{min-width:180px}
#outputSelect{min-width:160px}
/* room selector */
#roomThumb{font-size:20px;display:inline-flex;align-items:center;justify-content:center;padding:6px;border-radius:6px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06)}
#roomSelect{background:rgba(0,0,0,0.6);color:#fff;border:1px solid rgba(255,255,255,0.12);padding:6px;border-radius:6px;min-width:160px}
</style>
</head>
<body>

<video id="remoteVideo" autoplay playsinline></video>
<div id="controls">
	<button id="switchCamBtn">üì∑</button>
	<button id="micToggle" title="–í—ã–±—Ä–∞—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω">üéôÔ∏è</button>
	<select id="micSelect" aria-label="–í—ã–±–æ—Ä –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞" class="hidden"></select>
	<button id="outputToggle" title="–í—ã–±—Ä–∞—Ç—å –≤—ã—Ö–æ–¥">üîä</button>
	<select id="outputSelect" aria-label="–í—ã–±–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤—ã–≤–æ–¥–∞" class="hidden"></select>
	<span id="roomThumb">üè∑Ô∏è</span>
	<select id="roomSelect" aria-label="–í—ã–±–æ—Ä –∫–æ–º–Ω–∞—Ç—ã"></select>
</div>
<p id="status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</p>

<script>
// Try to stop service workers (if any) so they don't cache responses
if('serviceWorker' in navigator){
	navigator.serviceWorker.getRegistrations().then(regs=>regs.forEach(r=>r.unregister())).catch(()=>{});
}

// If the page is restored from bfcache, reload to get a fresh copy
window.addEventListener('pageshow', (e)=>{
	if(e.persisted) {
		const u = new URL(window.location.href);
		u.searchParams.set('_', Date.now());
		window.location.replace(u.toString());
	}
});

// Intercept F5 / Ctrl+R / Cmd+R and reload with cache-busting param
window.addEventListener('keydown', (e)=>{
	const isReload = e.key === 'F5' || ((e.ctrlKey||e.metaKey) && e.key.toLowerCase() === 'r');
	if(isReload){
		e.preventDefault();
		const u = new URL(window.location.href);
		u.searchParams.set('_', Date.now());
		window.location.href = u.toString();
	}
});
</script>
<script src="video-chat.js"></script>
</body>
</html>
